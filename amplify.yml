version: 1
applications:
  frontend:
    phases:
      preBuild:
        commands:
          - npm install -g pnpm
          - pnpm install --frozen-lockfile --prefer-offline
      build:
        commands:
          - env | grep -e NEXT_PUBLIC_ >> .env.production
          - pnpm run build
    artifacts:
      baseDirectory: .next
      files:
        - "**/*"
    cache:
      paths:
        - .next/cache/**/*
        - .pnpm-store/**/*
